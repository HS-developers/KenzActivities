<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ØªÙƒÙˆÙŠÙ† Ø§Ù„ÙØ±Ù‚ | Ø¨ÙˆØ§Ø¨Ø© ÙƒÙ†Ø² Ù„Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ØªØ±ÙÙŠÙ‡ÙŠØ©</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* âœ… Ø¶Ø¨Ø· Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden; /* ğŸ”¹ Ù…Ù†Ø¹ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ ÙŠÙ…ÙŠÙ† ÙˆØ´Ù…Ø§Ù„ */
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #1c0171 0%, #a6c1ee 100%);
    }

    /* âœ… Ø§Ù„Ù‡ÙŠØ¯Ø± */
    header {
      width: 100%;
      max-width: 1200px;
      margin: 20px auto 0;
      padding: 15px 30px;
      background: rgba(104, 26, 26, 0.85);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    header h1 {
      font-size: 2rem;
      font-weight: bold;
      margin: 0;
      background: linear-gradient(90deg, #ff9800, #ffeb3b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
      width: 100%;
    }

    /* âœ… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 10px;
    }

    /* âœ… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ */
    .game-btns {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin: 36px 0 18px 0;
      flex-wrap: wrap;
    }
    .game-btn {
      background: linear-gradient(90deg, #ff9800 40%, #ffd600 100%);
      color: #fff;
      border: none;
      border-radius: 18px;
      padding: 13px 38px;
      font-size: 1.15rem;
      font-family: 'Cairo', sans-serif;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0px 4px 18px #ffe082b0;
      letter-spacing: 1px;
      transition: background 0.3s, color 0.3s, transform 0.2s;
      outline: none;
      border: 2px solid #ffd600;
    }
    .game-btn.active, .game-btn:hover, .game-btn:focus {
      background: linear-gradient(90deg, #ffd600 30%, #ff9800 100%);
      color: #663c00;
      border-color: #ff9800;
      transform: scale(1.04);
    }

    /* âœ… Ø§Ù„Ø¨Ø§Ù†ÙŠÙ„ */
    .section-panel {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 24px rgba(255,193,7,0.13);
      padding: 27px 22px 19px 22px;
      width: 100%;
      max-width: 520px;
      margin-bottom: 26px;
    }
    .section-panel h2 {
      color: #ff9800;
      margin-bottom: 18px;
      font-size: 1.25rem;
      text-align: center;
      font-weight: bold;
    }

    /* âœ… Ø§Ù„ÙÙˆØ±Ù… */
    .team-form label {
      font-weight: bold;
      font-size: 1.05rem;
      color: #333;
      display: block;
      margin-bottom: 5px;
      margin-top: 13px;
    }
    .team-form input[type="text"] {
      width: 100%;
      padding: 11px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 1.05rem;
      font-family: inherit;
      outline: none;
      margin-bottom: 8px;
      transition: border 0.3s;
    }
    .team-form input[type="text"]:focus {
      border-color: #ff9800;
      box-shadow: 0 0 6px #ffeb3ba2;
    }

    /* âœ… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† */
    .players-list {
      display: flex;
      flex-direction: column;
      gap: 7px;
      max-height: 280px;
      overflow-y: auto;
      margin-bottom: 9px;
      border: 1px solid #ffe082;
      padding: 9px 8px;
      border-radius: 10px;
      background: #fffde7;
    }
    .player-item {
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 1.01em;
      background: #fffbe6;
      border-radius: 8px;
      padding: 7px 8px;
      transition: background 0.2s;
    }
    .player-item input[type="checkbox"] {
      accent-color: #ff9800;
      width: 18px;
      height: 18px;
      margin-left: 4px;
    }
    .player-name {
      font-weight: bold;
      color: #333;
      margin-left: 8px;
    }
    .player-id {
      color: #ff9800;
      background: #fff8e1;
      border-radius: 6px;
      padding: 0 6px;
      font-size: 0.92em;
      font-family: monospace;
    }
    .player-dob {
      color: #185a9d;
      font-size: 0.96em;
      background: #e3f2fd;
      border-radius: 6px;
      padding: 0 7px;
      margin-right: 4px;
    }

    /* âœ… Ø§Ù„ÙÙˆØªØ± */
    footer {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 15px 8px;
      background: rgba(255,255,255,0.95);
      text-align: center;
      font-size: 13px;
      color: #1e1d1d;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.07);
      border-top-left-radius: 15px;
      border-top-right-radius: 15px;
      margin-top: 10px;
    }

    /* âœ… Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    @media (max-width: 700px) {
      header h1 { font-size: 1.3rem;}
      .section-panel, .teams-list { padding: 13px 3vw; max-width: 95vw;}
      .team-card-title { font-size: 1em;}
    }
    /* âœ… ØªØµÙ…ÙŠÙ… Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙØ±Ù‚ */
#teams-count {
  text-align: center;
  font-size: 1.2rem;
  font-weight: bold;
  margin-bottom: 15px;
  color: #333;
}

/* âœ… ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ±ÙˆØª */
.team-card {
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  padding: 15px;
  margin-bottom: 18px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  animation: fadeIn 0.4s ease-in-out;
}

.team-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
}

/* âœ… Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ */
.team-card-title {
  font-size: 1.1rem;
  font-weight: bold;
  text-align: center;
  margin-bottom: 10px;
}

/* âœ… Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙŠ Badges */
.team-card-members {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  justify-content: center;
}

.team-member {
  background-color: #f5f5f5;
  padding: 6px 10px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
  color: #333;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}

/* âœ… Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙƒØ±ÙˆØª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù„Ø¹Ø¨Ø© */
.team-card[data-game="ÙƒØ±Ø© Ù‚Ø¯Ù…"] {
  border-top: 5px solid #4caf50; /* Ø£Ø®Ø¶Ø± */
}
.team-card[data-game="ÙƒØ±Ø© Ø·Ø§Ø¦Ø±Ø©"] {
  border-top: 5px solid #2196f3; /* Ø£Ø²Ø±Ù‚ */
}
.team-card[data-game="ÙƒØ±Ø© Ø³Ù„Ø©"] {
  border-top: 5px solid #ff9800; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
}

/* âœ… Ø£Ù†ÙŠÙ…ÙŠØ´Ù† */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* âœ… ØªØµÙ…ÙŠÙ… Ø²Ø± Ø­ÙØ¸ Ø§Ù„ÙØ±ÙŠÙ‚ */
#saveTeamBtn {
  /* âœ… Ø®ØµØ§Ø¦Øµ Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø°Ù‡Ø¨ÙŠ */
  background: linear-gradient(90deg, #ff9800 40%, #ffd600 100%);
  border: 2px solid #ffd600;
  box-shadow: 0px 4px 18px #ffe082b0;
  color: #fff;
  font-size: 1.15rem;
  font-weight: bold;
  letter-spacing: 1px;
  outline: none;
  padding: 13px 38px;
  border-radius: 18px;
  cursor: pointer;
  transition: background 0.3s, color 0.3s, transform 0.2s;
}

#saveTeamBtn:hover:not([disabled]) {
  background: linear-gradient(90deg, #ffd600 30%, #ff9800 100%);
  color: #663c00;
  border-color: #ff9800;
  transform: scale(1.04);
  /* âš ï¸ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù box-shadow Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø¨Ø­Ø§Ø¬Ø© Ø¥Ù„ÙŠÙ‡Ø§ */
  box-shadow: 0px 4px 18px #ff9800a2;
}

#saveTeamBtn:disabled {
Â  background-color: #bdbdbd; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø·ÙŠÙ„ */
Â  cursor: not-allowed;
Â  opacity: 0.6;
}

  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
</head>
<body>
  <header>
    <h1>ØªÙƒÙˆÙŠÙ† Ø§Ù„ÙØ±Ù‚ - Ø¨ÙˆØ§Ø¨Ø© ÙƒÙ†Ø² Ù„Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ØªØ±ÙÙŠÙ‡ÙŠØ©</h1>
  </header>
  <main>
    <div class="game-btns" id="gameBtns">
      <button type="button" class="game-btn" data-game="ÙƒØ±Ø© Ù‚Ø¯Ù…">âš½ ÙƒØ±Ø© Ù‚Ø¯Ù…</button>
      <button type="button" class="game-btn" data-game="ÙƒØ±Ø© Ø·Ø§Ø¦Ø±Ø©">ğŸ ÙƒØ±Ø© Ø·Ø§Ø¦Ø±Ø©</button>
      <button type="button" class="game-btn" data-game="ÙƒØ±Ø© Ø³Ù„Ø©">ğŸ€ ÙƒØ±Ø© Ø³Ù„Ø©</button>
    </div>
    <div class="section-panel" id="teamFormSection" style="display:none;">
      <form class="team-form" id="teamForm" autocomplete="off">
        <h2 id="formGameTitle">ØªÙƒÙˆÙŠÙ† ÙØ±ÙŠÙ‚</h2>
        <label for="teamName">Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚</label>
        <input type="text" id="teamName" required placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚">
        <div class="players-hint" id="playersHint"></div>
        <div class="players-list" id="playersList"></div>
        <div class="error" id="formError" style="display:none;"></div>
        <div class="success" id="formSuccess" style="display:none;"></div>
        <button type="submit" id="saveTeamBtn" disabled>Ø­ÙØ¸ Ø§Ù„ÙØ±ÙŠÙ‚</button>
      </form>
    </div>
    <div class="teams-list" id="teamsListSection" style="display:none;">
      <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
      <div id="teamsCards"></div>

      <!-- Ø²Ø± ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù… -->
      <div style="text-align:center; margin-top: 15px;" id="groupsButtonContainer" hidden>
    <button class="game-btn" onclick="askGroupSize()" style="background:#4caf50; color:white; padding:10px 20px; border-radius:10px; border:none; font-size:1rem; cursor:pointer;">
  ğŸ”€ ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
</button>
      </div>
    </div>
    </div>
  </main>
  <footer>
    Copyright Â© 2025 GENIUS Tech All Rights Reserved
  </footer>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBwc25f6ESvUx7Po55Mm9PQYZDT3L52dg8",
      authDomain: "kenz-activities.firebaseapp.com",
      projectId: "kenz-activities",
      storageBucket: "kenz-activities.firebasestorage.app",
      messagingSenderId: "323107285981",
      appId: "1:323107285981:web:0f1cad98fb5ab5ef306434",
      measurementId: "G-YVS8P6LQVW"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©
    const gameBtns = document.querySelectorAll('.game-btn');
    const teamFormSection = document.getElementById('teamFormSection');
    const formGameTitle = document.getElementById('formGameTitle');
    const teamForm = document.getElementById('teamForm');
    const teamNameInput = document.getElementById('teamName');
    const playersList = document.getElementById('playersList');
    const playersHint = document.getElementById('playersHint');
    const formError = document.getElementById('formError');
    const formSuccess = document.getElementById('formSuccess');
    const saveTeamBtn = document.getElementById('saveTeamBtn');
    const teamsListSection = document.getElementById('teamsListSection');
    const teamsCards = document.getElementById('teamsCards');

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
    let currentGame = null;
    let availablePlayers = [];
    let selectedPlayers = [];
    let teamsData = [];

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨
    const GAME_TYPES = {
      "ÙƒØ±Ø© Ù‚Ø¯Ù…": { icon: "âš½", eng: "Football" },
      "ÙƒØ±Ø© Ø·Ø§Ø¦Ø±Ø©": { icon: "ğŸ", eng: "Volleyball" },
      "ÙƒØ±Ø© Ø³Ù„Ø©": { icon: "ğŸ€", eng: "Basketball" },
    };

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙˆØ±Ù… Ø­Ø³Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©
    function selectGame(game) {
  currentGame = game;
  // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
  gameBtns.forEach(btn => {
    if (btn.dataset.game === game) btn.classList.add('active');
    else btn.classList.remove('active');
  });
  // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙˆØ±Ù…
  formGameTitle.textContent = `ØªÙƒÙˆÙŠÙ† ÙØ±ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯ ÙÙŠ ${GAME_TYPES[game].icon} ${game}`;
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙˆØ±Ù…
  teamForm.reset();
  playersList.innerHTML = '';
  playersHint.textContent = 'Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†...';
  formError.style.display = 'none';
  formSuccess.style.display = 'none';
  saveTeamBtn.disabled = true;
  selectedPlayers = [];
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙÙˆØ±Ù…
  teamFormSection.style.display = '';
  // Ø¬Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  fetchPlayersForGame(game);
  // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ÙƒØ±Ø© Ù‚Ø¯Ù…
  document.getElementById("groupsButtonContainer").hidden = (game !== "ÙƒØ±Ø© Ù‚Ø¯Ù…");
}


    // Ø¬Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ø¹ Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ù…Ù† ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡Ù… Ø¨Ø§Ù„ÙØ¹Ù„
    function fetchPlayersForGame(game) {
  playersList.innerHTML = '';
  playersHint.textContent = 'Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†...';
  availablePlayers = [];

  // Ø­Ø¯Ø¯ Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù†
  const adminEmails = [
    "activity_admin@k.compound.com",
    "fun25@kenzcompound.com"
  ];
  const currentUser = firebase.auth().currentUser;

  // Ù„Ùˆ Ù…Ø´ Ø£Ø¯Ù…Ù† â†’ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ
  db.collection('kenzTeams')
    .where('game', '==', game)
    .get()
    .then(teamsSnapshot => {
      let assignedUserIds = [];
      teamsSnapshot.forEach(doc => {
        const team = doc.data();
        if (Array.isArray(team.players)) {
          assignedUserIds.push(...team.players.map(player => player.id));
        }
      });

      db.collection('kenzActivities')
        .where('activities', 'array-contains', game)
        .get()
        .then(snapshot => {
          availablePlayers = snapshot.docs
            .map(doc => ({
              id: doc.data().userId,
              name: doc.data().name,
              unit: doc.data().unit,
              birthdate: doc.data().birthdate
            }))
            .filter(player => !assignedUserIds.includes(player.id));
          renderPlayersList();
        })
        .catch(() => {
          playersList.innerHTML = '';
          playersHint.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†';
        });
    })
    .catch(() => {
      playersList.innerHTML = '';
      playersHint.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†';
    });
}

    // Ø±Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø¹ Checkboxes ÙˆÙŠØ¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙƒÙˆØ¯ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯
    function renderPlayersList() {
      playersList.innerHTML = '';
      if (!availablePlayers.length) {
        playersHint.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù…ØªØ§Ø­ÙŠÙ† Ù„Ù‡Ø°Ø§ Ø§Ù„Ù†Ø´Ø§Ø·.';
        return;
      }
      playersHint.textContent = 'Ø§Ø®ØªØ± Ù…Ù† 4 Ø¥Ù„Ù‰ 6 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„ÙØ±ÙŠÙ‚. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ctrl+F ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­.';
      availablePlayers.forEach((player, idx) => {
        const item = document.createElement('label');
        item.className = 'player-item';

        // Ø¯Ø¹Ù… ÙƒØ§ÙØ© Ø­Ø§Ù„Ø§Øª ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ù†Øµ ÙÙ‚Ø· ÙÙŠ Ø­Ø§Ù„ØªÙƒ!)
        let dob = 'Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯';
        if (player.birthdate) {
          dob = player.birthdate;
        }

        item.innerHTML = `
          <input type="checkbox" value="${player.id}" data-name="${player.name}">
          <span class="player-name">${player.name}</span>
          <span class="player-id">${player.id}</span>
          <span class="player-dob">${dob}</span>
        `;
        playersList.appendChild(item);
      });
      // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±
      const checkboxes = playersList.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(cb => cb.addEventListener('change', handlePlayerSelection));
    }

    function handlePlayerSelection() {
      // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø®ØªØ§Ø±ÙŠÙ†
Â  Â  Â  const checked = Array.from(playersList.querySelectorAll('input[type="checkbox"]:checked'));
Â  Â  Â  selectedPlayers = checked.map(cb => ({
Â  Â  Â  Â  id: cb.value,
Â  Â  Â  Â  name: cb.getAttribute('data-name')
Â  Â  Â  }));
Â  Â  Â  saveTeamBtn.disabled = !(selectedPlayers.length >= 4 && selectedPlayers.length <= 6 && teamNameInput.value.trim());
Â  Â  Â  formError.style.display = 'none';
Â  Â  Â  formSuccess.style.display = 'none';
Â  Â  }

Â  Â  // ØªÙ…ÙƒÙŠÙ† Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ØµØ­ÙŠØ­ ÙˆØ§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ù…ÙˆØ¬ÙˆØ¯
Â  Â  teamNameInput.addEventListener('input', () => {
Â  Â  Â  saveTeamBtn.disabled = !(selectedPlayers.length >= 4 && selectedPlayers.length <= 6 && teamNameInput.value.trim());
Â  Â  Â  formError.style.display = 'none';
Â  Â  Â  formSuccess.style.display = 'none';
Â  Â  });

Â  Â  // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø­ÙØ¸ Ø§Ù„ÙØ±ÙŠÙ‚
Â  Â  teamForm.addEventListener('submit', function(e) {
Â  Â  Â  e.preventDefault();
Â  Â  Â  formError.style.display = 'none';
Â  Â  Â  formSuccess.style.display = 'none';
Â  Â  Â  const teamName = teamNameInput.value.trim();
Â  Â  Â  if (!teamName) {
Â  Â  Â  Â  formError.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚';
Â  Â  Â  Â  formError.style.display = '';
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (selectedPlayers.length < 4 || selectedPlayers.length > 6) {
Â  Â  Â  Â  formError.textContent = 'Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ù† 4 Ø¥Ù„Ù‰ 6 Ù„Ø§Ø¹Ø¨ÙŠÙ†';
Â  Â  Â  Â  formError.style.display = '';
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  // ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ù„Ù†ÙØ³ Ø§Ù„Ù„Ø¹Ø¨Ø©
Â  Â  Â  db.collection('kenzTeams')
Â  Â  Â  Â  .where('game', '==', currentGame)
Â  Â  Â  Â  .where('teamName', '==', teamName)
Â  Â  Â  Â  .get()
Â  Â  Â  Â  .then(snapshot => {
Â  Â  Â  Â  Â  if (!snapshot.empty) {
Â  Â  Â  Â  Â  Â  formError.textContent = 'Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¹Ø¨Ø©';
Â  Â  Â  Â  Â  Â  formError.style.display = '';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  // Ø­ÙØ¸ Ø§Ù„ÙØ±ÙŠÙ‚ (Ù‡Ù†Ø§ Ø§Ø³ØªØ®Ø¯Ù…Ù†Ø§ Timestamp Ø§Ù„ØµØ­ÙŠØ­)
Â  Â  Â  Â  Â  db.collection('kenzTeams').add({
Â  Â  Â  Â  Â  Â  teamName: teamName,
Â  Â  Â  Â  Â  Â  game: currentGame,
Â  Â  Â  Â  Â  Â  players: selectedPlayers,
Â  Â  Â  Â  Â  Â  createdAt: firebase.firestore.FieldValue.serverTimestamp()
Â  Â  Â  Â  Â  }).then(() => {
Â  Â  Â  Â  Â  Â  formSuccess.textContent = 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!';
Â  Â  Â  Â  Â  Â  formSuccess.style.display = '';
Â  Â  Â  Â  Â  Â  formError.style.display = 'none';
Â  Â  Â  Â  Â  Â  teamForm.reset();
Â  Â  Â  Â  Â  Â  saveTeamBtn.disabled = true;
Â  Â  Â  Â  Â  Â  selectedPlayers = [];
Â  Â  Â  Â  Â  Â  
             // âœ… ØªÙ… Ø¥Ø²Ø§Ù„Ø© setTimeout ÙˆØ§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹
Â  Â  Â  Â  Â  Â  fetchPlayersForGame(currentGame);
             loadTeamsList();

Â  Â  Â  Â  Â  }).catch(() => {
Â  Â  Â  Â  Â  Â  formError.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ÙØ±ÙŠÙ‚. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
Â  Â  Â  Â  Â  Â  formError.style.display = '';
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  });

Â  Â  // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ù†ÙˆØ¹ Ø§Ù„Ù„Ø¹Ø¨Ø©
Â  Â  gameBtns.forEach(btn => {
Â  Â  Â  btn.addEventListener('click', () => {
Â  Â  Â  Â  selectGame(btn.dataset.game);
Â  Â  Â  Â  loadTeamsList();
Â  Â  Â  });
Â  Â  });

Â  Â  // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±Ù‚ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø¨Ø¯ÙˆÙ† orderBy Ù…Ø¤Ù‚ØªÙ‹Ø§)
Â  Â  function loadTeamsList() {
Â  Â  Â  if (!currentGame) {
Â  Â  Â  Â  teamsListSection.style.display = 'none';
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  teamsCards.innerHTML = '<div style="text-align:center;font-size:1em;color:#888">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
Â  Â  Â  teamsListSection.style.display = '';
Â  Â  Â  db.collection('kenzTeams')
Â  Â  Â  Â  .where('game', '==', currentGame)
Â  Â  Â  Â  .get()
Â  Â  Â  Â  .then(snapshot => {
Â  Â  Â  Â  Â  teamsData = snapshot.docs.map(doc => doc.data());
Â  Â  Â  Â  Â  renderTeamsList();
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(() => {
Â  Â  Â  Â  Â  teamsCards.innerHTML = '<div style="color:#d32f2f;text-align:center;">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ±Ù‚</div>';
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Ø±Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ø§Ù„ØµÙØ­Ø© (ÙÙ‚Ø· Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ ÙˆØ£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†)
Â  Â  function renderTeamsList() {
Â  teamsCards.innerHTML = '';

Â  // âœ… Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙØ±Ù‚
Â  const teamsCount = document.createElement('h3');
Â  teamsCount.id = 'teams-count';
Â  teamsCount.textContent = `ğŸ”¹ Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: ${teamsData.length}`;
Â  teamsCards.appendChild(teamsCount);

Â  if (!teamsData.length) {
Â  Â  teamsCards.innerHTML += '<div style="color:#338;text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±Ù‚ Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.</div>';
Â  Â  return;
Â  }

Â  teamsData.forEach(team => {
Â  Â  const card = document.createElement('div');
Â  Â  card.className = 'team-card';
Â  Â  card.setAttribute("data-game", team.game);

Â  Â  card.innerHTML = `
Â  Â  Â  <div class="team-card-title">${team.teamName}</div>
Â  Â  Â  <div class="team-card-members">
Â  Â  Â  Â  ${team.players.map(player =>
Â  Â  Â  Â  Â  `<span class="team-member">${player.name}</span>`
Â  Â  Â  Â  ).join('')}
Â  Â  Â  </div>
Â  Â  `;

Â  Â  teamsCards.appendChild(card);
Â  });
}

Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  gameBtns[0].click();
Â  Â  });
Â  Â  function askGroupSize() {
Â  const input = prompt("ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ ÙÙŠ ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©ØŸ (ÙŠÙØ¶Ù„ 2 Ø£Ùˆ 3)");
Â  if (input === null) return;

Â  const size = parseInt(input, 10);
Â  if (!isNaN(size) && size > 0) {
Â  Â  // Ù†Ø¨Ø¹ØªÙ‡ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
Â  Â  window.location.href = `groups.html?groupSize=${size}`;
Â  } else {
Â  Â  alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ§Ù„Ø­ (Ø£ÙƒØ¨Ø± Ù…Ù† 0).");
Â  }
}
  </script>
</body>
</html>

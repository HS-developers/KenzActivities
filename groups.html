<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¯ÙˆØ±ÙŠ Ø£Ø¨Ø·Ø§Ù„ ÙƒÙ†Ø² Ù„ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù… - Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />
  <style>
  /* âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  html, body {
    height: 100%;
    width: 100%;
    overflow-x: hidden; /* ğŸ”¹ Ù…Ù†Ø¹ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ ÙŠÙ…ÙŠÙ† ÙˆØ´Ù…Ø§Ù„ */
  }
  body {
    min-height: 100vh;
    background: linear-gradient(135deg, #086fbe 0%, #e3e3e3 100%);
    font-family: 'Cairo', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* âœ… Ø§Ù„Ù‡ÙŠØ¯Ø± */
  header {
    width: 100%;
    max-width: 1200px;
    margin: 20px auto 0;
    background: rgba(9, 35, 84, 0.93);
    border-radius: 16px;
    box-shadow: 0 4px 16px #00000040;
    text-align: center;
    padding: 18px 10px 16px 10px;
  }
  header h1 {
    margin: 0;
    font-size: 2.2rem;
    font-weight: bold;
    color: #ffd700;
    letter-spacing: 1.2px;
    text-shadow: 0 2px 10px #293b5f, 0 0px 0 #fff;
    background: linear-gradient(90deg, #ffd700 50%, #ffffff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .champion-cup {
    font-size: 2.5em;
    vertical-align: middle;
    margin: 0 8px;
    color: #fff;
    text-shadow: 0 2px 8px #ffd700d0;
  }

  /* âœ… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 12px;
  }
  .groups-title {
    margin: 24px 0 7px 0;
    font-size: 1.35rem;
    color: #0d2847;
    font-weight: bold;
    text-align: center;
    background: linear-gradient(90deg, #ffd700 30%, #ffffff 70%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 1.5px;
  }

  /* âœ… Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª */
  .groups-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  padding: 20px;
}

.group-card {
  background: #ffffff;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  padding: 20px;
  transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.group-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
}

.group-name {
  font-size: 1.3rem;
  font-weight: bold;
  margin-bottom: 12px;
  color: #1e88e5;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.team-count {
  font-size: 0.85rem;
  background: #e3f2fd;
  color: #1976d2;
  padding: 4px 10px;
  border-radius: 20px;
}

.team-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.team-list li {
  display: flex;
  align-items: center;
  background: #f7f9fc;
  padding: 8px 12px;
  border-radius: 10px;
  margin-bottom: 8px;
  transition: background 0.2s ease;
}

.team-list li:hover {
  background: #e3f2fd;
}

.team-icon {
  margin-right: 10px;
  font-size: 1.2rem;
}

.badge {
  margin-left: auto;
  padding: 4px 10px;
  border-radius: 12px;
  color: #fff;
  font-size: 0.8rem;
  font-weight: bold;
}

.badge-football {
  background: #43a047; /* Ø£Ø®Ø¶Ø± Ù„ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù… */
}

.badge-basketball {
  background: #ef6c00; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„ÙƒØ±Ø© Ø§Ù„Ø³Ù„Ø© */
}

.badge-chess {
  background: #6a1b9a; /* Ø¨Ù†ÙØ³Ø¬ÙŠ Ù„Ù„Ø´Ø·Ø±Ù†Ø¬ */
}


  /* âœ… Ø±Ø³Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª */
  .no-groups-msg {
    color: #888;
    text-align: center;
    margin: 18px 0 30px 0;
    font-size: 1.14em;
  }

  /* âœ… Ø§Ù„ÙÙˆØªØ± */
  footer {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 15px 8px;
    background: rgba(255,255,255,0.94);
    text-align: center;
    font-size: 14px;
    color: #1e1d1d;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.07);
    border-top-left-radius: 15px;
    border-top-right-radius: 15px;
  }

  /* âœ… Ø­Ø±ÙƒØ© Ù„Ø·ÙŠÙØ© Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.97); }
    to { opacity: 1; transform: scale(1); }
  }

  /* âœ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  @media (max-width: 900px) {
    header h1 { font-size: 1.6rem; }
    .groups-container {
      flex-direction: column;
      align-items: center;
      gap: 22px;
    }
    .group-card { max-width: 95vw; width: 100%; }
  }
</style>


  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
</head>
<body>
  <header>
    <span class="champion-cup">ğŸ†</span>
    <h1>Ø¯ÙˆØ±ÙŠ Ø£Ø¨Ø·Ø§Ù„ ÙƒÙ†Ø² Ù„ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…</h1>
    <span class="champion-cup">ğŸ†</span>
  </header>
  <main>
    <div class="groups-title">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</div>
    <div class="groups-container" id="groupsContainer"></div>
    <div class="no-groups-msg" id="noGroupsMsg" style="display:none;">
      Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨Ø¹Ø¯.<br>Ø³Ø¬Ù‘Ù„ Ø§Ù„ÙØ±Ù‚ Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† ØµÙØ­Ø© ØªÙƒÙˆÙŠÙ† Ø§Ù„ÙØ±Ù‚.
    </div>
  </main>
  <footer>
    Copyright Â© 2025 GENIUS Tech All Rights Reserved
  </footer>
  <script>
    firebase.auth().onAuthStateChanged(function(user) {
      if (!user) {
        // Redirect to the admin login page if no user is logged in
        window.location.href = 'login.html';
      }
    });
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBwc25f6ESvUx7Po55Mm9PQYZDT3L52dg8",
      authDomain: "kenz-activities.firebaseapp.com",
      projectId: "kenz-activities",
      storageBucket: "kenz-activities.firebasestorage.app",
      messagingSenderId: "323107285981",
      appId: "1:323107285981:web:0f1cad98fb5ab5ef306434",
      measurementId: "G-YVS8P6LQVW"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const groupsContainer = document.getElementById('groupsContainer');
    const noGroupsMsg = document.getElementById('noGroupsMsg');

    let teamsPerGroup = 2;

    // Ø§Ù‚Ø±Ø£ Ù‚ÙŠÙ…Ø© groupSize Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù† ÙˆÙØ¬Ø¯
const urlParams = new URLSearchParams(window.location.search);
const size = parseInt(urlParams.get('groupSize'), 10);
if (!isNaN(size) && size >= 1) teamsPerGroup = size; // Ø§Ù‚Ø¨Ù„ 1 ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰

    // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ÙØ±Ù‚ Ø¥Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
    function splitTeamsToGroups(teams, perGroup) {
      const shuffled = teams.sort(() => Math.random() - 0.5);
      const groups = [];
      for (let i = 0; i < shuffled.length; i += perGroup) {
        groups.push(shuffled.slice(i, i + perGroup));
      }
      return groups;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª (ØªØ­Ø³ÙŠÙ†: Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù„Ùˆ Ø§Ù„Ù…ØµÙÙˆÙØ© ÙØ§Ø±ØºØ©)
function renderGroups(groups) {
  groupsContainer.innerHTML = '';
  if (!Array.isArray(groups) || groups.length === 0) {
    groupsContainer.innerHTML = '<div class="no-groups-msg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.</div>';
    return;
  }
  groups.forEach((group, idx) => {
    const groupCard = document.createElement('div');
    groupCard.className = 'group-card';
    groupCard.innerHTML = `
      <div class="group-name">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${String.fromCharCode(65 + idx)}</div>
      <ul class="team-list">
        ${group.map(team => `<li><span class="team-icon">âš½</span>${team.teamName || team.name || 'Ø±Ù‚Ù… ÙØ±ÙŠÙ‚'}</li>`).join('')}
      </ul>
    `;
    groupsContainer.appendChild(groupCard);
  });
}

// Ø¬Ù„Ø¨ Ø§Ù„ÙØ±Ù‚ ÙˆØ¹Ø±Ø¶Ù‡Ø§ Ù…Ø¹ ØªØ³Ø¬ÙŠÙ„ Ù…ÙØµÙ‘Ù„ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
function fetchFootballTeams() {
  // ÙˆØ¶Ø¹ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ø¤Ù‚ØªØ©
  groupsContainer.innerHTML = '<div style="text-align:center;color:#888;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª...</div>';

  db.collection('kenzTeams')
    .where('game', '==', 'ÙƒØ±Ø© Ù‚Ø¯Ù…')
    .get()
    .then(snapshot => {
      console.log('fetchFootballTeams: snapshot.size =', snapshot.size);
      const teams = snapshot.docs.map(doc => {
        const data = doc.data();
        return Object.assign({ _id: doc.id }, data);
      });

      // Ù„Ø§ ÙØ±Ù‚
      if (!teams.length) {
        groupsContainer.innerHTML = '';
        noGroupsMsg.style.display = '';
        return;
      }

      noGroupsMsg.style.display = 'none';

      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ Ø£Ù‚Ù„ Ù…Ù† teamsPerGroup ÙØ§Ø¬Ø¹Ù„Ù‡Ù… ÙƒÙ„Ù‡Ù… ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
      if (teams.length <= teamsPerGroup) {
        teamsPerGroup = teams.length;
      }

      // Ø­Ø§Ù„Ø© ÙØ±ÙŠÙ‚ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· â€” Ø¶Ø¹ ÙƒÙ„ Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
      const groups = teams.length === 1 ? [teams] : splitTeamsToGroups(teams, teamsPerGroup);

      console.log('fetchFootballTeams: teams.length =', teams.length, ' -> groups.length =', groups.length, 'teamsPerGroup=', teamsPerGroup);
      renderGroups(groups);
    })
    .catch(error => {
      // Ø§Ø·Ø¨Ø¹ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ Ø¹Ø´Ø§Ù† Ù†Ø¹Ø±Ù Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† Ù‡ÙŠ Ø§Ù„Ø³Ø¨Ø¨
      console.error('fetchFootballTeams error:', error);
      // Ù„Ùˆ Ø§Ù„Ø®Ø·Ø£ permission-deniedØŒ Ø§Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø£ÙˆØ¶Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
      if (error && error.code === 'permission-denied') {
        groupsContainer.innerHTML = '<div class="no-groups-msg">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª â€” ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù†.</div>';
      } else {
        groupsContainer.innerHTML = '<div class="no-groups-msg">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</div>';
      }
    });
}

// **Ø§Ù„Ù…Ù‡Ù…**: Ù†Ù†ØªØ¸Ø± Ø­Ø¯Ø« Auth state Ù„Ø£Ù† Ù‚ÙˆØ§Ø¹Ø¯Ùƒ Ù‚Ø¯ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ request.auth
firebase.auth().onAuthStateChanged((user) => {
  console.log('Auth state changed, user =', user ? user.email : null);

  // Ù„Ùˆ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ØªÙ…Ù†Ø¹ ØºÙŠØ± Ø§Ù„Ø£Ø¯Ù…Ù†ÙŠÙ†ØŒ Ù†ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„
  if (!user) {
    // Ù„Ùˆ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¶Ø¹ Ù‡Ù†Ø§ redirect
    // window.location.href = 'login.html';
    // Ø£Ù…Ø§ Ø§Ù„Ø¢Ù†ØŒ Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø£Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨
    groupsContainer.innerHTML = '<div class="no-groups-msg">Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª.</div>';
    return;
  }

  // Ù„Ùˆ ÙƒÙ†Øª ØªØ³ØªØ¹Ù…Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·ØŒ ØªØ­Ù‚Ù‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  const adminEmails = ['activity_admin@k.compound.com', 'fun25@kenzcompound.com'];
  if (!adminEmails.includes(user.email)) {
    console.warn('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ØŒ ÙˆÙ„ÙƒÙ† Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ÙŠØ³ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯Ù…Ù†. Ù‚ÙˆØ§Ø¹Ø¯ Firestore Ù‚Ø¯ ØªÙ…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„.');
    // Ù†Ø³Ù…Ø­ Ø¨Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø£Ù† Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ù‚Ø¯ ØªØ³Ù…Ø­ Ø£ÙŠØ¶Ø§Ù‹ØŒ Ù„ÙƒÙ† Ù†Ù†Ø¨Ù‡Ùƒ
  }

  // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ userØŒ Ù†Ù†ÙÙ‘Ø° Ø§Ù„Ø¬Ù„Ø¨
  fetchFootballTeams();
});

// Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', () => {
  const urlParams = new URLSearchParams(window.location.search);
  const size = parseInt(urlParams.get('groupSize'));

  if (!isNaN(size) && size >= 2) {
    teamsPerGroup = size;
  }
  fetchFootballTeams();
});


  </script>
</body>
</html>
